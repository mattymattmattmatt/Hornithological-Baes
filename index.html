<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hornithological Baes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#050816;--bg-elevated:#0d1022;--accent:#4f46e5;--accent-soft:rgba(79,70,229,.15);
      --accent-strong:rgba(129,140,248,.35);--text-main:#f9fafb;--text-muted:#9ca3af;
      --border-subtle:rgba(148,163,184,.25);--danger:#ef4444;--radius-lg:18px;--radius-md:12px;
      --shadow-soft:0 18px 45px rgba(15,23,42,.65);
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:"Inter",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background:radial-gradient(circle at top left,#1d2446 0,transparent 55%),
                 radial-gradient(circle at bottom right,#164e63 0,transparent 55%),
                 var(--bg);
      color:var(--text-main);min-height:100vh;
    }
    .app-shell{max-width:1120px;margin:0 auto;padding:28px 16px 40px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:24px}
    .title-block{display:flex;flex-direction:column;gap:8px}
    .title-row{display:flex;align-items:center;gap:12px}
    .logo{
      height:122px;
      width:auto;border-radius:12px;object-fit:contain;background:rgba(15,23,42,.7);
      padding:4px 8px;border:1px solid rgba(148,163,184,.4);
    }
    /* Live indicator pill (now clickable) */
    .title-pill{
      appearance:none;
      border:none;
      font-size:.78rem;
      text-transform:uppercase;
      letter-spacing:.17em;
      color:#e5e7eb;
      background:rgba(255,255,255,.08);
      border-radius:999px;
      padding:4px 10px;
      border:1px solid rgba(255,255,255,.18);
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:default;
      user-select:none;
    }
    .title-pill.has-new{ cursor:pointer; }
    .title-pill:focus{ outline:none; box-shadow:0 0 0 2px rgba(129,140,248,.35); }
    .title-pill-dot{
      width:8px;height:8px;border-radius:999px;
      display:inline-block;
    }
    .title-pill-dot.live-stale{
      background:#ef4444;
      box-shadow:0 0 0 0 rgba(239,68,68,.0);
    }
    @keyframes pulseGreen {
      0% { box-shadow:0 0 0 0 rgba(52,211,153,.35); filter:brightness(1.0); }
      50% { box-shadow:0 0 0 6px rgba(52,211,153,.0); filter:brightness(1.2); }
      100% { box-shadow:0 0 0 0 rgba(52,211,153,.0); filter:brightness(1.0); }
    }
    .title-pill-dot.live-new{
      background:#34d399;
      box-shadow:0 0 0 4px rgba(52,211,153,.35);
      animation:pulseGreen 1.25s ease-in-out infinite;
    }
    .title-block h1{margin:0;font-size:1.9rem;letter-spacing:.03em}
    .title-block p{margin:0;font-size:.9rem;color:var(--text-muted)}

    /* NEW: Subtle days-since text under title (motivational) */
    .days-since {
      margin-top: 6px;
      font-size: 0.85rem;
      color: var(--text-muted);
      font-weight: 400;
      letter-spacing: .02em;
    }
    .days-since.urgent {
      color: #f59e0b;
    }

    .layout{display:grid;grid-template-columns:minmax(0,340px) minmax(0,1fr);gap:20px}
    @media (max-width:900px){header{flex-direction:column;align-items:flex-start}.layout{grid-template-columns:minmax(0,1fr)}}
    .card{
      background:radial-gradient(circle at top,rgba(148,163,184,.12) 0,transparent 55%),var(--bg-elevated);
      border-radius:var(--radius-lg);padding:18px 18px 16px;box-shadow:var(--shadow-soft);
      border:1px solid rgba(148,163,184,.18);backdrop-filter:blur(18px);
    }
    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:10px}
    .card-header h2{margin:0;font-size:1rem;letter-spacing:.08em;text-transform:uppercase;color:#e5e7eb}
    .card-header-actions{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:nowrap;
    }
    .dropzone{
      border-radius:var(--radius-md);border:1px dashed rgba(148,163,184,.55);padding:18px;
      background:radial-gradient(circle at top left,rgba(79,70,229,.16) 0,transparent 55%),rgba(15,23,42,.85);
      display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;
      transition:border .15s ease,background .15s ease,transform .08s ease;cursor:pointer;
    }
    .dropzone.dragover{
      border-color:#a5b4fc;background:radial-gradient(circle at top left,rgba(79,70,229,.45) 0,transparent 65%),rgba(15,23,42,.96);
      transform:translateY(-1px);
    }
    .dropzone-icon{
      width:40px;height:40px;border-radius:16px;background:linear-gradient(145deg,rgba(129,140,248,.3),rgba(56,189,248,.25));
      display:flex;align-items:center;justify-content:center;margin-bottom:8px;box-shadow:0 14px 35px rgba(37,99,235,.5);
    }
    .dropzone-icon svg{width:21px;height:21px}
    .dropzone strong{font-size:.92rem}
    .dropzone p{margin:3px 0 0;font-size:.8rem;color:var(--text-muted)}
    .chip{display:inline-flex;align-items:center;gap:6px;margin-top:10px;padding:3px 8px;border-radius:999px;background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.4);font-size:.78rem;color:var(--text-muted)}
    .chip-dot{width:6px;height:6px;border-radius:999px;background:#38bdf8}
    .hidden-input{display:none}
    .preview{margin-top:10px;display:flex;gap:10px;align-items:center}
    .preview img{width:70px;height:70px;object-fit:cover;border-radius:14px;border:1px solid rgba(148,163,184,.4)}
    .preview-text{font-size:.82rem;color:var(--text-muted)}
    .preview-text strong{color:#e5e7eb}
    .form-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    .field{display:flex;flex-direction:column;gap:4px}
    .field label{font-size:.8rem;text-transform:uppercase;letter-spacing:.15em;color:var(--text-muted)}
    .field input{
      border-radius:999px;border:1px solid var(--border-subtle);background:rgba(15,23,42,.9);padding:8px 12px;
      font-size:.9rem;color:var(--text-main);outline:none;transition:border .15s ease,box-shadow .15s ease,background .15s ease;
    }
    .field input:focus{border-color:#a5b4fc;box-shadow:0 0 0 1px rgba(129,140,248,.55);background:rgba(15,23,42,.98)}
    .species-input-row{display:flex;gap:8px;align-items:center}
    .species-input-row input{flex:1;cursor:pointer}
    .checklist-btn{
      border-radius:999px;border:1px solid rgba(129,140,248,.7);background:rgba(79,70,229,.16);color:#c7d2fe;
      font-size:.78rem;padding:6px 10px;cursor:pointer;white-space:nowrap;
    }
    .checklist-btn:hover{background:rgba(79,70,229,.26)}
    .actions-row{margin-top:12px;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .text-muted{font-size:.78rem;color:var(--text-muted)}
    .btn-primary{
      appearance:none;border:none;border-radius:999px;padding:8px 16px;font-size:.9rem;font-weight:600;
      background:linear-gradient(135deg,#4f46e5,#06b6d4);color:#fff;cursor:pointer;display:inline-flex;align-items:center;gap:8px;
      box-shadow:0 12px 28px rgba(37,99,235,.55);transition:transform .08s ease,box-shadow .08s ease,filter .12s ease;
    }
    .btn-primary span{font-size:1rem}
    .btn-primary:disabled{opacity:.6;cursor:default;box-shadow:none;transform:none}
    .btn-primary:not(:disabled):hover{transform:translateY(-1px);filter:brightness(1.06);box-shadow:0 16px 36px rgba(37,99,235,.75)}
    .error-message{margin-top:6px;font-size:.78rem;color:#fecaca}
    .success-message{margin-top:6px;font-size:.78rem;color:#bbf7d0}
    .gallery-header{
      display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px;
      position:relative;
    }
    .gallery-header h2{margin:0;font-size:1rem;text-transform:uppercase;letter-spacing:.11em}
    .gallery-header small{font-size:.8rem;color:var(--text-muted)}
    .filter-badges{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end}
    .filter-badge{
      font-size:.76rem;padding:3px 9px;border-radius:999px;border:1px solid rgba(148,163,184,.4);
      color:var(--text-muted);background:rgba(15,23,42,.9);
    }
    .filter-badge.sort-btn{
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      color:#e5e7eb;
      border-color:rgba(129,140,248,.55);
      background:rgba(79,70,229,.16);
    }
    .filter-badge.sort-btn:hover{
      background:rgba(79,70,229,.26);
    }
    .sort-menu{
      position:absolute;
      right:0;
      top:100%;
      margin-top:6px;
      background:rgba(15,23,42,.98);
      border-radius:14px;
      border:1px solid rgba(148,163,184,.45);
      box-shadow:0 18px 45px rgba(15,23,42,.9);
      padding:6px;
      z-index:15;
      min-width:220px;
      display:none;
    }
    .sort-menu.show{display:block;}
    .sort-option{
      width:100%;
      appearance:none;
      border:none;
      background:transparent;
      color:#e5e7eb;
      text-align:left;
      padding:6px 8px;
      border-radius:10px;
      font-size:.82rem;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:center;
    }
    .sort-option span.hint{color:var(--text-muted);font-size:.76rem;}
    .sort-option:hover{
      background:rgba(79,70,229,.2);
    }
    .gallery-empty{padding:16px 12px 12px;border-radius:var(--radius-md);background:rgba(15,23,42,.85);border:1px dashed rgba(148,163,184,.45);
      text-align:center;font-size:.86rem;color:var(--text-muted)}
    .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:14px}
    .photo-card{
      background:radial-gradient(circle at top,rgba(79,70,229,.18) 0,transparent 55%),rgba(15,23,42,.96);
      border-radius:16px;border:1px solid rgba(148,163,184,.3);overflow:hidden;display:flex;flex-direction:column;min-height:230px;
    }
    .photo-thumb{position:relative;padding-top:66%;overflow:hidden}
    .photo-thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transform-origin:center;transition:transform .2s ease-out}
    .photo-card:hover .photo-thumb img{transform:scale(1.03)}
    .rarity-badge-wrap{
      position:absolute;left:8px;bottom:8px;width:42px;height:42px;border-radius:14px;
      background:rgba(15,23,42,.55);border:1px solid rgba(148,163,184,.55);
      display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px);
      box-shadow:0 10px 25px rgba(15,23,42,.7);pointer-events:none;
    }
    .rarity-badge{width:32px;height:32px;object-fit:contain;display:block;}
    .fullscreen-btn {
      position: absolute;
      right: 6px;
      bottom: 6px;
      border: none;
      background: none;
      color: #e5e7eb;
      font-size: 16px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      text-shadow: 0 1px 3px rgba(0,0,0,0.9);
    }
    .fullscreen-btn:hover { transform: scale(1.05); }
    .image-fullscreen-overlay {
      position: fixed;
      inset: 0;
      background: rgba(3,7,18,0.96);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 120;
    }
    .image-fullscreen-overlay.show { display: flex; }
    .image-fullscreen-overlay img {
      max-width: 100vw;
      max-height: 100vh;
      object-fit: contain;
    }
    .image-fullscreen-overlay::after {
      content: "Tap anywhere to close";
      position: absolute;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8rem;
      color: rgba(229,231,235,0.8);
    }
    .photo-body{padding:10px 11px 9px;display:flex;flex-direction:column;gap:5px;flex-grow:1}
    .photo-title{font-size:.95rem;font-weight:600;color:#e5e7eb}
    .photo-uploaded-by{font-size:.78rem;color:var(--text-muted)}
    .photo-location-row{display:flex;justify-content:space-between;gap:6px;align-items:center}
    .photo-location{font-size:.8rem;color:var(--text-muted)}
    .repeat-species-tag{font-size:.75rem;color:#a5b4fc;background:rgba(79,70,229,.16);border-radius:999px;padding:2px 8px;border:1px solid rgba(129,140,248,.5);white-space:nowrap}
    .photo-meta-row{display:flex;justify-content:space-between;align-items:center;margin-top:2px;gap:6px}
    .rating-wrapper{display:flex;flex-direction:column;gap:3px}
    .parrots{display:inline-flex;gap:1px;flex-wrap:wrap;font-size:.9rem}
    .parrot{opacity:.2;transition:opacity .15s ease}
    .parrot.filled{opacity:1}
    .rating-text{font-size:.75rem;color:var(--text-muted)}
    .time-tag{font-size:.76rem;color:var(--text-muted);padding:4px 9px;border-radius:999px;background:rgba(15,23,42,.9);border:1px solid rgba(148,163,184,.4)}
    .card-footer-row{display:flex;justify-content:space-between;margin-top:6px;gap:8px;align-items:center}
    .footer-actions-left{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .rate-btn,.comments-btn{
      border:none;border-radius:999px;padding:4px 10px;font-size:.75rem;cursor:pointer;
      background:rgba(79,70,229,.18);color:#c7d2fe;border:1px solid rgba(129,140,248,.6)
    }
    .rate-btn[disabled]{opacity:.55;cursor:default;background:rgba(15,23,42,.85);border-style:dashed;color:#9ca3af}
    .rate-btn:hover:not(:disabled),.comments-btn:hover{background:rgba(79,70,229,.28)}
    .delete-btn{border:none;border-radius:999px;padding:4px 10px;font-size:.75rem;cursor:pointer;background:rgba(239,68,68,.12);color:#fecaca;border:1px solid rgba(248,113,113,.5);display:inline-flex;align-items:center;gap:6px}
    .delete-btn:hover{background:rgba(239,68,68,.22)}
    footer{margin-top:18px;font-size:.78rem;color:var(--text-muted);text-align:right;opacity:.8}
    .pager{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding-top:10px;
      border-top:1px solid rgba(148,163,184,.18);
    }
    .pager-left{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .pager-info{font-size:.8rem;color:var(--text-muted)}
    .pager-btn{
      border-radius:999px;
      border:1px solid rgba(129,140,248,.65);
      background:rgba(79,70,229,.16);
      color:#c7d2fe;
      font-size:.8rem;
      padding:6px 10px;
      cursor:pointer;
    }
    .pager-btn:disabled{
      opacity:.55;
      cursor:default;
      border-style:dashed;
      background:rgba(15,23,42,.85);
      color:#9ca3af;
    }
    .pager-btn:hover:not(:disabled){background:rgba(79,70,229,.26)}
    .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.7);display:none;align-items:center;justify-content:center;z-index:50;padding:16px}
    .modal-backdrop.show{display:flex}
    .modal{
      background:rgba(15,23,42,.96);border-radius:18px;padding:16px 16px 14px;max-width:380px;width:100%;
      box-shadow:0 20px 50px rgba(15,23,42,.9);border:1px solid rgba(148,163,184,.5)
    }
    .modal-wide{max-width:980px;}
    .modal-header{margin-bottom:8px;display:flex;gap:12px;justify-content:space-between;align-items:flex-start}
    .modal-header h3{margin:0;font-size:1rem}
    .modal-header p{margin:4px 0 0;font-size:.8rem;color:var(--text-muted)}
    .modal-footer{margin-top:10px;display:flex;justify-content:flex-end;gap:8px}
    .modal-cancel{
      border-radius:999px;border:1px solid rgba(148,163,184,.6);
      background:rgba(15,23,42,.9);color:var(--text-muted);
      font-size:.78rem;padding:6px 12px;cursor:pointer
    }
    .modal-cancel:hover{background:rgba(15,23,42,1)}
    .modal-accent{
      border-radius:999px;border:1px solid rgba(129,140,248,.7);
      background:rgba(79,70,229,.16);color:#c7d2fe;
      font-size:.78rem;padding:6px 12px;cursor:pointer
    }
    .modal-accent:hover{background:rgba(79,70,229,.26)}
    .rating-options{margin-top:10px;display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:6px}
    .rating-option{border-radius:999px;border:1px solid rgba(129,140,248,.7);background:rgba(79,70,229,.2);padding:4px 6px;font-size:.78rem;color:#e5e7eb;cursor:pointer;
      display:flex;align-items:center;justify-content:center;gap:4px}
    .rating-option span.emoji{font-size:1rem}
    .rating-option:hover{background:rgba(79,70,229,.35)}
    .rating-option.selected{
      border-color: rgba(187,247,208,.85);
      background: rgba(34,197,94,.18);
      color:#dcfce7;
    }
    .comments-list{
      margin-top:10px;max-height:40vh;overflow:auto;padding-right:4px;
      display:flex;flex-direction:column;gap:8px;
    }
    .comment-empty{font-size:.82rem;color:var(--text-muted);padding:6px 2px}
    .comment-item{
      border:1px solid rgba(148,163,184,.35);
      background:rgba(15,23,42,.9);
      border-radius:14px;
      padding:8px 10px;
    }
    .comment-meta{
      display:flex;justify-content:space-between;gap:8px;align-items:center;margin-bottom:4px;
    }
    .comment-meta .time{font-size:.75rem;color:var(--text-muted)}
    .comment-del{
      width:26px;height:26px;border-radius:999px;
      border:1px solid rgba(248,113,113,.55);
      background:rgba(239,68,68,.10);
      color:#fecaca;
      font-size:18px;line-height:1;
      cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      padding:0;
    }
    .comment-del:hover{background:rgba(239,68,68,.20)}
    .comment-text{
      font-size:.88rem;color:#e5e7eb;line-height:1.35;
      white-space:pre-wrap;word-break:break-word
    }
    .comment-compose{margin-top:10px;display:flex;flex-direction:column;gap:8px;}
    textarea.comment-input{
      width:100%;min-height:72px;resize:none;border-radius:14px;
      border:1px solid rgba(148,163,184,.35);background:rgba(15,23,42,.92);
      padding:10px 10px;color:#e5e7eb;font-family:"Inter",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      font-size:.9rem;outline:none;
    }
    textarea.comment-input:focus{
      border-color:#a5b4fc;box-shadow:0 0 0 1px rgba(129,140,248,.55);background:rgba(15,23,42,.98);
    }
    .comment-send{
      align-self:flex-end;appearance:none;border:none;border-radius:999px;padding:8px 14px;
      font-size:.85rem;font-weight:700;background:linear-gradient(135deg,#4f46e5,#06b6d4);
      color:#fff;cursor:pointer;box-shadow:0 12px 28px rgba(37,99,235,.45);
    }
    .comment-send:disabled{opacity:.6;cursor:default;box-shadow:none}
    .comment-send:hover:not(:disabled){filter:brightness(1.05);transform:translateY(-1px)}
    .species-overlay{position:fixed;inset:0;background:rgba(15,23,42,.92);display:none;align-items:center;justify-content:center;padding:16px;z-index:60}
    .species-overlay.show{display:flex}
    .species-panel{max-width:520px;width:100%;max-height:90vh;background:rgba(15,23,42,.98);border-radius:20px;border:1px solid rgba(148,163,184,.5);
      box-shadow:0 24px 60px rgba(15,23,42,.95);padding:16px 16px 14px;display:flex;flex-direction:column}
    .species-panel-header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    .species-panel-header h3{margin:0;font-size:1rem}
    .species-panel-header p{margin:4px 0 0;font-size:.8rem;color:var(--text-muted)}
    .species-close-btn{border-radius:999px;border:1px solid rgba(148,163,184,.6);background:rgba(15,23,42,.9);color:var(--text-muted);font-size:.78rem;padding:4px 10px;cursor:pointer;white-space:nowrap}
    .species-close-btn:hover{background:rgba(15,23,42,1)}
    .species-tally{
      margin-top:6px;
      font-size:.8rem;
      color:var(--text-muted);
    }
    .species-tally span.seen{color:#bbf7d0;font-weight:600;}
    .species-tally span.unseen{color:#e5e7ebb0;}
    .species-search-row{margin-top:10px}
    .species-search-row input{
      width:100%;border-radius:999px;border:1px solid var(--border-subtle);background:rgba(15,23,42,.9);padding:8px 12px;
      font-size:.9rem;color:var(--text-main);outline:none;
    }
    .species-search-row input:focus{border-color:#a5b4fc;box-shadow:0 0 0 1px rgba(129,140,248,.55);background:rgba(15,23,42,.98)}
    .species-list{margin-top:10px;overflow-y:auto;padding-right:4px}
    .species-empty{font-size:.82rem;color:var(--text-muted);padding:8px 2px}
    .species-item{
      width:100%;border-radius:999px;border:1px solid rgba(148,163,184,.4);background:rgba(15,23,42,.9);color:#e5e7eb;font-size:.86rem;
      padding:6px 10px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;gap:8px;cursor:pointer;
    }
    .species-item:hover{background:rgba(15,23,42,1)}
    .species-item.seen{border-color:rgba(129,140,248,.8);background:rgba(79,70,229,.18)}
    .species-name{text-align:left}
    .species-status{font-size:.75rem;color:#a5b4fc;padding:2px 8px;border-radius:999px;border:1px solid rgba(129,140,248,.7);white-space:nowrap}
    .merlin-help{
      appearance:none;width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-top:10px;padding:10px 12px;border-radius:999px;border:1px solid rgba(148,163,184,0.45);
      background: radial-gradient(circle at top left, rgba(34,197,94,0.18) 0, transparent 55%), rgba(15,23,42,0.9);
      color:#e5e7eb;font-size:0.86rem;cursor:pointer;text-align:left;
    }
    .merlin-help strong{ color:#bbf7d0; font-weight:700; }
    .merlin-help:hover{
      border-color: rgba(187,247,208,0.75);
      background: radial-gradient(circle at top left, rgba(34,197,94,0.28) 0, transparent 60%), rgba(15,23,42,1);
    }
    .rankings-btn,.gallery-btn{
      font-size:.78rem;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(129,140,248,.7);
      background:rgba(79,70,229,.18);
      color:#c7d2fe;
      cursor:pointer;
      white-space:nowrap;
    }
    .rankings-btn:hover,.gallery-btn:hover{background:rgba(79,70,229,.28)}
    .rankings-list{margin-top:10px;display:flex;flex-direction:column;gap:8px;max-height:55vh;overflow:auto;padding-right:3px}
    .rankings-row{
      display:grid;
      grid-template-columns:40px 1fr 80px 90px;
      gap:10px;
      align-items:center;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.25);
      background:rgba(15,23,42,.9);
      font-size:.88rem;
    }
    .rankings-head{
      background:rgba(79,70,229,.14);
      border-color:rgba(129,140,248,.35);
      font-size:.78rem;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:var(--text-muted);
    }
    .rankings-row .right{text-align:right}
    .rankings-empty{font-size:.82rem;color:var(--text-muted);padding:6px 2px}
    .rules-box{
      margin-top:10px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.25);
      background:rgba(15,23,42,.9);
      padding:10px 12px;
      color:#e5e7eb;
      font-size:.86rem;
      line-height:1.35;
    }
    .rules-box code{
      display:inline-block;
      margin-top:6px;
      padding:4px 8px;
      border-radius:10px;
      background:rgba(79,70,229,.14);
      border:1px solid rgba(129,140,248,.35);
      color:#e5e7eb;
      font-size:.82rem;
    }
    .rules-list{margin:8px 0 0;padding-left:18px;color:var(--text-muted)}
    .rules-list li{margin:4px 0}
    .collage-scroll{
      max-height:80vh;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,.18);
      background:rgba(15,23,42,.55);
    }
    .collage-grid{
      display:grid;
      grid-template-columns:repeat(5,minmax(0,1fr));
      gap:12px;
      align-content:start;
    }
    @media (max-width:520px){ .collage-grid{grid-template-columns:repeat(4,minmax(0,1fr));} }
    @media (max-width:380px){ .collage-grid{grid-template-columns:repeat(3,minmax(0,1fr));} }
    .collage-tile{
      position:relative;
      width:100%;
      padding-top:100%;
      overflow:hidden;
      border:0;
      background:transparent;
      border-radius:0;
      margin:0;
      display:block;
      cursor:pointer;
    }
    .collage-tile img{
      position:absolute;inset:0;
      width:100%;height:100%;
      object-fit:cover;
      display:block;
    }
    @media (hover:none) and (pointer:coarse){
      body{ background: var(--bg); }
      .card{ backdrop-filter:none; box-shadow:none; }
      .rarity-badge-wrap{ backdrop-filter:none; box-shadow:none; }
      .dropzone-icon{ box-shadow:none; }
      .btn-primary{ box-shadow:none; }
      .photo-thumb img{ transition:none; }
    }
    @media (prefers-reduced-motion: reduce){
      *{ scroll-behavior:auto !important; }
      .photo-thumb img{ transition:none !important; }
      .btn-primary{ transition:none !important; }
      .dropzone{ transition:none !important; }
      .parrot{ transition:none !important; }
      .title-pill-dot.live-new{ animation:none !important; }
    }
    .photo-card{
      content-visibility:auto;
      contain: layout paint;
      contain-intrinsic-size: 280px 260px;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="title-block">
      <div class="title-row">
        <img src="Logo.png" alt="Hornithological Baes logo" class="logo">
        <div>
          <button type="button" id="liveIndicatorBtn" class="title-pill" aria-label="Live birb status">
            <span id="liveDot" class="title-pill-dot live-stale"></span>
            <span id="liveText">LIVE BIRB PHOTO LOG</span>
          </button>
          <h1>Hornithological Baes</h1>
          <div id="daysSince" class="days-since">Loading last sighting‚Ä¶</div>
        </div>
      </div>
      <p>Drop your birb pics, tag where and what they are, and let the flock rate your shots out of 10.</p>
    </div>
  </header>
  <div class="layout">
    <section class="card">
      <div class="card-header">
        <h2>Add a sighting</h2>
        <div class="card-header-actions">
          <button type="button" id="openRankingsBtn" class="rankings-btn">Rankings</button>
          <button type="button" id="openCollageBtn" class="gallery-btn">Gallery</button>
        </div>
      </div>
      <div id="dropzone" class="dropzone">
        <div class="dropzone-icon">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M12 3L7 9h3v4h4V9h3l-5-6z" stroke="#e5e7eb" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 19h14" stroke="#e5e7eb" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </div>
        <strong>Drop a birb photo</strong>
        <p>or click to browse ‚Äì JPG, PNG, HEIC etc.</p>
        <div class="chip"><span class="chip-dot"></span>Tip: keep the bird centred & in focus ‚Äî it helps you score higher</div>
        <input id="fileInput" class="hidden-input" type="file" accept="image/*" />
      </div>
      <div id="preview" class="preview" style="display:none;">
        <img id="previewImg" alt="Preview" />
        <div class="preview-text">
          <div><strong id="previewName"></strong></div>
          <div style="margin-top:2px;">Ready to upload (will be downscaled)</div>
        </div>
      </div>
      <div class="form-grid">
        <div class="field">
          <label for="birdName">Birb species</label>
          <div class="species-input-row">
            <input id="birdName" type="text" placeholder="Choose from checklist" autocomplete="off" readonly />
            <button type="button" id="openChecklistBtn" class="checklist-btn">Checklist</button>
          </div>
        </div>
        <div class="field">
          <label for="location">Where spotted</label>
          <input id="location" type="text" placeholder="e.g. Adelaide Botanic Gardens, SA" autocomplete="off" />
        </div>
        <div class="field">
          <label for="uploadedBy">Uploaded by</label>
          <input id="uploadedBy" type="text" placeholder="Your name or nickname" autocomplete="off" />
        </div>
      </div>
      <div class="actions-row">
        <div class="text-muted" id="statusText">All uploads are public. Please keep it friendly.</div>
        <button id="uploadBtn" class="btn-primary"><span>‚Üë</span>Save sighting</button>
      </div>
      <div id="errorMsg" class="error-message" style="display:none;"></div>
      <div id="successMsg" class="success-message" style="display:none;"></div>
    </section>
    <section id="galleryCard" class="card">
      <div class="gallery-header">
        <div>
          <h2>Latest birbs</h2>
          <small id="galleryCountLabel">Loading sightings‚Ä¶</small>
        </div>
        <div class="filter-badges">
          <button id="sortModeBtn" class="filter-badge sort-btn" type="button">
            <span id="sortModeLabel">Newest first</span> ‚ñæ
          </button>
          <span class="filter-badge">Ratings use ü¶ú out of 10</span>
        </div>
        <div id="sortMenu" class="sort-menu">
          <button class="sort-option" data-mode="newest">
            <span>Newest first</span>
            <span class="hint">Latest uploads on top</span>
          </button>
          <button class="sort-option" data-mode="highestRated">
            <span>Highest rated</span>
            <span class="hint">Best average /10</span>
          </button>
          <button class="sort-option" data-mode="mostValuable">
            <span>Most valuable</span>
            <span class="hint">Rating √ó rarity multiplier</span>
          </button>
          <button class="sort-option" data-mode="rarity">
            <span>Rarity</span>
            <span class="hint">Super rare ‚Üí very common</span>
          </button>
          <button class="sort-option" data-mode="oldest">
            <span>Oldest first</span>
            <span class="hint">Archive from the beginning</span>
          </button>
        </div>
      </div>
      <div id="galleryEmpty" class="gallery-empty" style="display:none;">
        No birb photos yet. Upload the very first sighting and start the flock.
      </div>
      <div id="galleryGrid" class="gallery-grid"></div>
      <div id="pager" class="pager" style="display:none;">
        <div class="pager-left">
          <button id="prevPageBtn" class="pager-btn" type="button">‚Üê Prev</button>
          <button id="nextPageBtn" class="pager-btn" type="button">Next ‚Üí</button>
        </div>
        <div class="pager-info" id="pageInfo">Page 1 of 1</div>
      </div>
    </section>
  </div>
  <footer>Hornithological Baes ¬∑ Firebase ¬∑ GitHub Pages</footer>
</div>

<!-- All modals unchanged from your original -->
<div id="speciesOverlay" class="species-overlay">
  <div class="species-panel">
    <div class="species-panel-header">
      <div>
        <h3>Select birb species</h3>
        <p>Search and tap a species to fill the form. Species you've already logged are marked as seen.</p>
      </div>
      <button type="button" id="closeSpeciesOverlayBtn" class="species-close-btn">Close</button>
    </div>
    <div id="speciesTally" class="species-tally">
      Species checklist loading‚Ä¶
    </div>
    <div class="species-search-row">
      <input id="speciesSearch" type="text" placeholder="Search Australian birb species‚Ä¶" />
    </div>
    <button type="button" class="merlin-help" id="merlinSmartBtn">
      Not sure what species? <strong>Identify it in Merlin Bird ID</strong> ‚Üí
    </button>
    <div id="speciesList" class="species-list"></div>
  </div>
</div>
<!-- (all other modals exactly as in your original code) -->
<div id="imageFullscreenOverlay" class="image-fullscreen-overlay">
  <img id="imageFullscreenImg" src="" alt="Full-size birb">
</div>

<script type="module">
  const firebaseConfig = {
    apiKey: "AIzaSyDkmpTvNw1IOCxS1NFr9_fqkZY73N0f1P8",
    authDomain: "hornithological-baes.firebaseapp.com",
    projectId: "hornithological-baes",
    storageBucket: "hornithological-baes.firebasestorage.app",
    messagingSenderId: "909306883752",
    appId: "1:909306883752:web:daf920bede5aa6fadf1c9d",
    measurementId: "G-T9VSSKQS0Q"
  };
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import {
    getFirestore, collection, addDoc, onSnapshot, orderBy, query, doc, getDoc, getDocs,
    updateDoc, deleteDoc, serverTimestamp, increment
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  import {
    getStorage, ref as storageRef, uploadBytes, getDownloadURL, deleteObject
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);
  const deviceKey = "hb_device_id_v1";
  let deviceId = localStorage.getItem(deviceKey);
  if (!deviceId) {
    deviceId = (crypto.randomUUID ? crypto.randomUUID() : (String(Date.now()) + "_" + Math.random().toString(16).slice(2)));
    localStorage.setItem(deviceKey, deviceId);
  }
  const uploaderKey = "hb_uploaded_by_v1";
  let storedUploader = "";
  try { storedUploader = (localStorage.getItem(uploaderKey) || "").trim(); } catch { storedUploader = ""; }
  const lastSeenKey = "hb_last_seen_ts_v1";
  let lastSeenTs = 0;
  try {
    const raw = localStorage.getItem(lastSeenKey);
    if (raw) lastSeenTs = parseInt(raw, 10) || 0;
  } catch { lastSeenTs = 0; }
  let newestTs = 0;
  let newSinceLastSeenCount = 0;
  let initialSnapshotHandled = false;
  let newestPhotoId = null;
  let SPECIES = [];
  let SPECIES_INDEX = new Map();
  let speciesLoaded = false;
  let speciesLoadError = false;
  const normalizeName = (s) => (s || "")
    .trim()
    .toLowerCase()
    .replace(/[‚Äô‚Äò]/g, "'")
    .replace(/[‚Äì‚Äî]/g, "-")
    .replace(/\s+/g, " ");
  function normalizeRarity(r) {
    const v = (r || "").toString().trim().toLowerCase();
    const map = {
      "super rare": "super_rare",
      "super-rare": "super_rare",
      "super_rare": "super_rare",
      "rare": "rare",
      "uncommon": "uncommon",
      "common": "common",
      "very common": "very_common",
      "very-common": "very_common",
      "very_common": "very_common",
      "unknown": "unknown"
    };
    return map[v] || "unknown";
  }
  function rarityLabel(token) {
    switch (token) {
      case "super_rare": return "Super rare";
      case "rare": return "Rare";
      case "uncommon": return "Uncommon";
      case "common": return "Common";
      case "very_common": return "Very common";
      default: return "";
    }
  }
  function getRarityForSpecies(speciesName) {
    const entry = SPECIES_INDEX.get(normalizeName(speciesName));
    if (!entry) return null;
    const rarity = normalizeRarity(entry.rarity);
    if (!rarity || rarity === "unknown") return null;
    return rarity;
  }
  async function loadSpeciesJson() {
    try {
      const res = await fetch("species-au.json", { cache: "no-cache" });
      if (!res.ok) throw new Error("Failed to fetch species JSON");
      const data = await res.json();
      let list = [];
      if (Array.isArray(data)) list = data;
      else if (Array.isArray(data.species)) list = data.species;
      SPECIES = list.map((x) => {
        if (typeof x === "string") return { name: x, rarity: "unknown" };
        return { name: x?.name || "", rarity: normalizeRarity(x?.rarity) };
      }).filter(x => x.name && x.name.trim().length > 0);
      SPECIES_INDEX = new Map();
      for (const item of SPECIES) {
        SPECIES_INDEX.set(normalizeName(item.name), { name: item.name.trim(), rarity: normalizeRarity(item.rarity) });
      }
      speciesLoaded = true;
      speciesLoadError = false;
      updateSpeciesTally();
      renderSpeciesList(speciesSearch.value);
    } catch (err) {
      console.error("Error loading species-au.json", err);
      speciesLoaded = true;
      speciesLoadError = true;
      updateSpeciesTally();
      renderSpeciesList(speciesSearch.value);
    }
  }
  loadSpeciesJson();
  const photosCol = collection(db, "birdPhotos");

  // DOM elements
  const liveIndicatorBtn = document.getElementById("liveIndicatorBtn");
  const liveDot = document.getElementById("liveDot");
  const liveText = document.getElementById("liveText");
  const dropzone = document.getElementById("dropzone");
  const fileInput = document.getElementById("fileInput");
  const preview = document.getElementById("preview");
  const previewImg = document.getElementById("previewImg");
  const previewName = document.getElementById("previewName");
  const birdNameInput = document.getElementById("birdName");
  const locationInput = document.getElementById("location");
  const uploadedByInput = document.getElementById("uploadedBy");
  const uploadBtn = document.getElementById("uploadBtn");
  const statusText = document.getElementById("statusText");
  const errorMsg = document.getElementById("errorMsg");
  const successMsg = document.getElementById("successMsg");
  const galleryGrid = document.getElementById("galleryGrid");
  const galleryEmpty = document.getElementById("galleryEmpty");
  const galleryCountLabel = document.getElementById("galleryCountLabel");
  const pager = document.getElementById("pager");
  const prevPageBtn = document.getElementById("prevPageBtn");
  const nextPageBtn = document.getElementById("nextPageBtn");
  const pageInfo = document.getElementById("pageInfo");
  const ratingModalBackdrop = document.getElementById("ratingModalBackdrop");
  const ratingOptionButtons = ratingModalBackdrop.querySelectorAll(".rating-option");
  const commentsModalBackdrop = document.getElementById("commentsModalBackdrop");
  const commentsTitle = document.getElementById("commentsTitle");
  const commentsSubtitle = document.getElementById("commentsSubtitle");
  const commentsList = document.getElementById("commentsList");
  const commentInput = document.getElementById("commentInput");
  const commentSend = document.getElementById("commentSend");
  const commentsClose = document.getElementById("commentsClose");
  const speciesOverlay = document.getElementById("speciesOverlay");
  const speciesListEl = document.getElementById("speciesList");
  const speciesSearch = document.getElementById("speciesSearch");
  const openChecklistBtn = document.getElementById("openChecklistBtn");
  const closeSpeciesOverlayBtn = document.getElementById("closeSpeciesOverlayBtn");
  const speciesTallyEl = document.getElementById("speciesTally");
  const merlinSmartBtn = document.getElementById("merlinSmartBtn");
  const openRankingsBtn = document.getElementById("openRankingsBtn");
  const rankingsModalBackdrop = document.getElementById("rankingsModalBackdrop");
  const rankingsClose = document.getElementById("rankingsClose");
  const rankingsList = document.getElementById("rankingsList");
  const rankingsRulesBtn = document.getElementById("rankingsRulesBtn");
  const scoringModalBackdrop = document.getElementById("scoringModalBackdrop");
  const scoringClose = document.getElementById("scoringClose");
  const sortModeBtn = document.getElementById("sortModeBtn");
  const sortModeLabel = document.getElementById("sortModeLabel");
  const sortMenu = document.getElementById("sortMenu");
  const imageFsOverlay = document.getElementById("imageFullscreenOverlay");
  const imageFsImg = document.getElementById("imageFullscreenImg");
  const openCollageBtn = document.getElementById("openCollageBtn");
  const collageModalBackdrop = document.getElementById("collageModalBackdrop");
  const collageCloseTop = document.getElementById("collageCloseTop");
  const collageGrid = document.getElementById("collageGrid");

  // Prefill uploader
  if (storedUploader) {
    uploadedByInput.value = storedUploader;
    uploadedByInput.readOnly = true;
  }

  // Live indicator
  function setLiveIndicator(hasNew) {
    if (hasNew) {
      liveDot.classList.add("live-new");
      liveDot.classList.remove("live-stale");
      liveIndicatorBtn.classList.add("has-new");
      liveText.textContent = "NEW BIRB!, TAP HERE!";
    } else {
      liveDot.classList.remove("live-new");
      liveDot.classList.add("live-stale");
      liveIndicatorBtn.classList.remove("has-new");
      liveText.textContent = "LIVE BIRB PHOTO LOG";
    }
  }
  setLiveIndicator(false);

  /* NEW: Days since last new birb */
  function updateDaysSince() {
    const el = document.getElementById("daysSince");
    if (!el) return;

    if (!newestTs || currentPhotos.length === 0) {
      el.textContent = "No birbs yet ‚Äì be the first! ü¶ú";
      el.classList.remove("urgent");
      return;
    }

    const days = Math.floor((Date.now() - newestTs) / 86400000);

    let text = "";
    if (days === 0) {
      text = "New birb spotted today! üî•";
    } else if (days === 1) {
      text = "Last new birb was yesterday";
    } else if (days < 5) {
      text = `Last new birb was ${days} days ago`;
    } else {
      text = `It‚Äôs been ${days} days since the last new birb‚Ä¶`;
      el.classList.add("urgent");
    }
    el.textContent = text;
  }

  // Merlin opener (unchanged)
  function openMerlinSmart() {
    const merlinWeb = "https://merlin.allaboutbirds.org/";
    const iosStore = "https://apps.apple.com/au/app/merlin-bird-id-by-cornell-lab/id773457673";
    const playStore = "https://play.google.com/store/apps/details?id=com.labs.merlinbirdid.app&hl=en_AU";
    const ua = navigator.userAgent || "";
    const isAndroid = /Android/i.test(ua);
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    const androidIntent = "intent://merlin.allaboutbirds.org/#Intent;scheme=https;package=com.labs.merlinbirdid.app;S.browser_fallback_url=" + encodeURIComponent(playStore) + ";end";
    const fallback = isIOS ? iosStore : isAndroid ? playStore : "https://merlin.allaboutbirds.org/download/";
    const start = Date.now();
    window.location.href = isAndroid ? androidIntent : merlinWeb;
    setTimeout(() => {
      if (document.visibilityState === "visible" && (Date.now() - start) > 700) {
        window.location.href = fallback;
      }
    }, 1100);
  }
  if (merlinSmartBtn) merlinSmartBtn.addEventListener("click", openMerlinSmart);

  // ... (all your existing code for file handling, downscale, upload, resetForm, showError, etc. remains 100% the same) ...

  const qPhotos = query(photosCol, orderBy("createdAt", "desc"));
  onSnapshot(qPhotos, (snapshot) => {
    const docs = [];
    snapshot.forEach(docSnap => docs.push({ id: docSnap.id, data: docSnap.data() }));
    latestDocsForRankings = docs;
    currentPhotos = docs;
    if (collageModalBackdrop.classList.contains("show")) renderCollage();
    if (!storedUploader) {
      const mine = docs.find(x => x?.data?.ownerDeviceId === deviceId && (x?.data?.uploadedBy || "").trim());
      if (mine) {
        storedUploader = (mine.data.uploadedBy || "").trim();
        if (storedUploader) {
          try { localStorage.setItem(uploaderKey, storedUploader); } catch {}
          uploadedByInput.value = storedUploader;
          uploadedByInput.readOnly = true;
        }
      }
    }
    let maxTs = 0;
    let maxId = null;
    let countNew = 0;
    docs.forEach(({ id, data }) => {
      const d = getCreatedDate(data);
      if (!d) return;
      const t = d.getTime();
      if (t > maxTs || (t === maxTs && id && maxId && id < maxId)) {
        maxTs = t;
        maxId = id;
      }
      if (lastSeenTs && t > lastSeenTs) countNew++;
    });
    if (!initialSnapshotHandled) {
      initialSnapshotHandled = true;
      if (!lastSeenTs && maxTs) {
        lastSeenTs = maxTs;
        try { localStorage.setItem(lastSeenKey, String(lastSeenTs)); } catch {}
        countNew = 0;
      }
    }
    newestTs = maxTs;
    newestPhotoId = maxId;
    newSinceLastSeenCount = countNew;
    setLiveIndicator(newSinceLastSeenCount > 0);

    // NEW: Update the days-since text every time the snapshot fires
    updateDaysSince();

    totalPages = Math.max(1, Math.ceil(currentPhotos.length / PAGE_SIZE));
    if (currentPage > totalPages - 1) currentPage = totalPages - 1;
    if (rankingsModalBackdrop.classList.contains("show")) {
      renderRankings(buildRankings(latestDocsForRankings));
    }
    renderGallery();
  });

  // ... (all your other functions: getCreatedDate, updateSpeciesTally, renderGallery, prev/next page, openRatingModal, ratePhoto, openCommentsModal, deletePhoto, openSpeciesOverlay, renderSpeciesList, buildRankings, renderRankings, setSortMode, etc. remain exactly as in your original) ...

  // At the very end of the script (just before </script>)
  // Initial update in case snapshot is slow
  setTimeout(updateDaysSince, 1200);
</script>
</body>
</html>
